@model List<AuctionApp.Data.Bid>
@{
    ViewData["Title"] = "Admin Dashboard";
}

<div class="container mt-4">
    <div class="row mb-4">
        <div class="col-12">
            <h2>Admin Dashboard - Live Bid Monitoring</h2>
            <p class="text-muted">Real-time view of all auction activity | Logged in as: @ViewBag.Username</p>
        </div>
    </div>

    @if (TempData["Message"] != null)
    {
        <div class="alert alert-info alert-dismissible fade show">
            @TempData["Message"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <div class="row">
        <div class="col-12">
            @if (Model.Any())
            {
                <div class="table-responsive">
                    <table class="table table-bordered" id="bids-table" style="border: 2px solid #dee2e6;">
                        <thead style="background-color: #343a40; color: white;">
                            <tr>
                                <th style="padding: 15px; border: 1px solid #dee2e6;">Bid ID</th>
                                <th style="padding: 15px; border: 1px solid #dee2e6;">Item</th>
                                <th style="padding: 15px; border: 1px solid #dee2e6;">Bidder</th>
                                <th style="padding: 15px; border: 1px solid #dee2e6;">Amount</th>
                                <th style="padding: 15px; border: 1px solid #dee2e6;">Time</th>
                                <th style="padding: 15px; border: 1px solid #dee2e6;">Role</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var bid in Model.OrderByDescending(b => b.BidTime))
                            {
                                <tr data-bid-id="@bid.BidID" style="background-color: white;">
                                    <td style="padding: 15px; border: 1px solid #dee2e6;">@bid.BidID</td>
                                    <td style="padding: 15px; border: 1px solid #dee2e6;">@bid.ItemName</td>
                                    <td style="padding: 15px; border: 1px solid #dee2e6;">@bid.Username</td>
                                    <td style="padding: 15px; border: 1px solid #dee2e6; font-weight: bold; color: #28a745;">$@bid.Amount</td>
                                    <td style="padding: 15px; border: 1px solid #dee2e6;">@bid.BidTime.ToString("MM/dd/yyyy HH:mm:ss")</td>
                                    <td style="padding: 15px; border: 1px solid #dee2e6;">
                                        <span class="badge @(bid.Role == "Admin" ? "bg-danger" : "bg-primary")" style="padding: 8px 12px; font-size: 14px;">
                                            @bid.Role
                                        </span>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="alert alert-info" style="padding: 30px; font-size: 18px;">
                    <h5>No Bids Yet</h5>
                    <p>No bids have been placed yet. Bids will appear here in real-time as they are placed.</p>
                </div>
            }
        </div>
    </div>

    <div class="row mt-4">
        <form action="/Home/Logout" method="post">
            <button type="submit" class="btn btn-danger btn-lg" style="padding: 12px 30px;">Logout</button>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof connection !== 'undefined' && connection) {
                connection.on("BidUpdated", function (itemId, newPrice, bidderName) {
                    addNewBidRow(itemId, newPrice, bidderName);
                });
            }
        });

        function addNewBidRow(itemId, amount, bidderName) {
            const table = document.querySelector('#bids-table tbody');
            if (table) {
                const now = new Date();
                const timeString = now.toLocaleDateString() + ' ' + now.toLocaleTimeString();

                const newRow = document.createElement('tr');
                newRow.style.backgroundColor = '#d4edda';
                newRow.setAttribute('data-bid-id', 'new');
                newRow.innerHTML = `
                    <td style="padding: 15px; border: 1px solid #dee2e6;">New</td>
                    <td style="padding: 15px; border: 1px solid #dee2e6;">Item ${itemId}</td>
                    <td style="padding: 15px; border: 1px solid #dee2e6;">${bidderName}</td>
                    <td style="padding: 15px; border: 1px solid #dee2e6; font-weight: bold; color: #28a745;">$${amount}</td>
                    <td style="padding: 15px; border: 1px solid #dee2e6;">${timeString}</td>
                    <td style="padding: 15px; border: 1px solid #dee2e6;"><span class="badge bg-primary" style="padding: 8px 12px; font-size: 14px;">Bidder</span></td>
                `;

                table.insertBefore(newRow, table.firstChild);

                setTimeout(() => {
                    newRow.style.backgroundColor = 'white';
                }, 3000);
            }
        }
    </script>
}